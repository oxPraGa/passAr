!function(){"use strict";function o(e,o,t){x.push({onUpdate:e,onComplete:o,duration:t,started:window.performance.now()}),e(0)}function t(){var e=[];x.forEach(function(o){var t=window.performance.now(),n=(t-o.started)/o.duration;1>n?(o.onUpdate(n),e.push(o)):(o.onUpdate(1),o.onComplete())}),x=e}function n(){try{var e=document.createElement("canvas");return!(!window.hasOwnProperty("WebGLRenderingContext")||!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(o){return!1}}function r(e){return JSON.parse(JSON.stringify(e))}function i(e){if("string"!=typeof e)return!1;var o=e.split("-");return 2!==o.length?!1:a(o[0])&&a(o[1])}function a(e){return s(e)||p(e)}function s(e){return"string"!=typeof e?!1:-1!==e.search(/^[a-h][1-8]$/)}function p(e){return"string"!=typeof e?!1:-1!==e.search(/^s[bw][1-6]$/)}function c(e){return"string"!=typeof e?!1:-1!==e.search(/^[bw][KQRNBP]$/)}function l(e){if("string"!=typeof e)return!1;e=e.replace(/ .+$/,"");var o=e.split("/");if(8!==o.length)return!1;for(var t=0;8>t;t++)if(""===o[t]||o[t].length>8||-1!==o[t].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0}function u(e){if("object"!=typeof e)return!1;for(var o in e)if(e.hasOwnProperty(o)===!0&&(a(o)!==!0||c(e[o])!==!0))return!1;return!0}function f(e){return e.toLowerCase()===e?"b"+e.toUpperCase():"w"+e.toUpperCase()}function d(e){var o=e.split("");return"w"===o[0]?o[1].toUpperCase():o[1].toLowerCase()}function h(e){if(l(e)!==!0)return!1;e=e.replace(/ .+$/,"");for(var o=e.split("/"),t={},n=8,r=0;8>r;r++){for(var i=o[r].split(""),a=0,s=0;s<i.length;s++)if(-1!==i[s].search(/[1-8]/))a+=parseInt(i[s],10);else{var p=E[a]+n;t[p]=f(i[s]),a++}n--}return t}function w(e){if(u(e)!==!0)return!1;for(var o="",t=8,n=0;8>n;n++){for(var r=0;8>r;r++){var i=E[r]+t;o+=e.hasOwnProperty(i)===!0?d(e[i]):"1"}7!==n&&(o+="/"),t--}return o=o.replace(/11111111/g,"8"),o=o.replace(/1111111/g,"7"),o=o.replace(/111111/g,"6"),o=o.replace(/11111/g,"5"),o=o.replace(/1111/g,"4"),o=o.replace(/111/g,"3"),o=o.replace(/11/g,"2")}var v=71,y="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",E="abcdefgh".split(""),m=[[50,40,30],[-50,0,-30]],g=2,b=Math.PI/4,P=18.25,S={sw1:"wK",sw2:"wQ",sw3:"wR",sw4:"wB",sw5:"wN",sw6:"wP",sb1:"bK",sb2:"bQ",sb3:"bR",sb4:"bB",sb5:"bN",sb6:"bP"},O=.75,x=[];window.ChessBoard3=window.ChessBoard3||function(a,c){function f(e,o,t){c.showErrors;if(c.hasOwnProperty("showErrors")===!0&&c.showErrors!==!1){var n="ChessBoard3 Error "+e+": "+o;return c.hasOwnProperty("showErrors")&&"console"===c.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(n),void(arguments.length>=2&&console.log(t))):"alert"===c.showErrors?(t&&(n+="\n\n"+JSON.stringify(t)),void window.alert(n)):void("function"==typeof c.showErrors&&c.showErrors.call(e,o,t))}}function d(){if(void 0===THREE||void 0===THREE.REVISION||isNaN(parseInt(THREE.REVISION))||parseInt(THREE.REVISION)<v)return console.log("ChessBoard3 Error 3006: Unable to find three.js revision 71 or greater. \n\nExiting..."),!1;if(!n())return window.alert("ChessBoard3 Error 3001: WebGL is not enabled.\n\nExiting..."),!1;if("string"==typeof a){if(""===a)return window.alert("ChessBoard3 Error 1001: The first argument to ChessBoard3() cannot be an empty string.\n\nExiting..."),!1;var e=document.getElementById(a);if(!e)return window.alert('ChessBoard Error 1002: Element with id "'+a+'"does not exist in the DOM.\n\nExiting...'),!1;Ee=e}else if(Ee=a,-1!==Ee.length)return window.alert("ChessBoard3 Error 1003: The first argument to ChessBoard3() must be an ID or a single DOM node.\n\nExiting..."),!1;return!0}function x(e){return"fast"===e||"slow"===e?!0:parseInt(e,10)+""!=e+""?!1:e>=0}function C(){return("string"==typeof c||u(c))&&(c={position:c}),"black"!==c.orientation&&(c.orientation="white"),Je=c.orientation,c.showNotation!==!1&&(c.showNotation=!0,(c.hasOwnProperty("fontData")!==!0||"string"!=typeof c.fontData&&"function"!=typeof c.fontData)&&(c.fontData="assets/fonts/helvetiker_regular.typeface.json")),c.draggable!==!0&&(c.draggable=!1),"trash"!==c.dropOffBoard&&(c.dropOffBoard="snapback"),c.sparePieces!==!0&&(c.sparePieces=!1),c.sparePieces===!0&&(c.draggable=!0),(c.hasOwnProperty("pieceSet")!==!0||"string"!=typeof c.pieceSet&&"function"!=typeof c.pieceSet)&&(c.pieceSet="assets/chesspieces/iconic/{piece}.json"),c.rotateControls!==!1&&(c.rotateControls=!0),c.zoomControls!==!0&&(c.zoomControls=!1),c.hasOwnProperty("appearSpeed")!==!0||x(c.appearSpeed)!==!0?c.appearSpeed=200:c.hasOwnProperty("appearSpeed")&&("slow"===c.appearSpeed?c.appearSpeed=400:"fast"===c.appearSpeed&&(c.appearSpeed=100)),c.hasOwnProperty("moveSpeed")!==!0||x(c.moveSpeed)!==!0?c.moveSpeed=200:c.hasOwnProperty("moveSpeed")&&("slow"===c.moveSpeed?c.moveSpeed=400:"fast"===c.moveSpeed&&(c.moveSpeed=100)),c.hasOwnProperty("snapbackSpeed")!==!0||x(c.snapbackSpeed)!==!0?c.snapbackSpeed=50:c.hasOwnProperty("snapbackSpeed")&&("slow"===c.snapbackSpeed?c.snapbackSpeed=100:"fast"===c.snapbackSpeed&&(c.snapbackSpeed=25)),c.hasOwnProperty("snapSpeed")!==!0||x(c.snapSpeed)!==!0?c.snapSpeed=25:c.hasOwnProperty("snapSpeed")&&("slow"===c.snapSpeed?c.snapSpeed=50:"fast"===c.snapSpeed&&(c.snapSpeed=10)),c.hasOwnProperty("trashSpeed")!==!0||x(c.trashSpeed)!==!0?c.trashSpeed=100:c.hasOwnProperty("trashSpeed")&&("slow"===c.trashSpeed?c.trashSpeed=200:"fast"===c.trashSpeed&&(c.trashSpeed=50)),c.hasOwnProperty("position")===!0&&("start"===c.position?$e=r(Oe):l(c.position)===!0?$e=h(c.position):u(c.position)===!0?$e=r(c.position):f(7263,"Invalid value passed to config.position.",c.position)),!0}function R(){"black"!==c.orientation&&(c.orientation="white"),me=new THREE.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0,antialias:!0,transparent:!0});var e;e=c.hasOwnProperty("backgroundColor")&&"number"==typeof c.backgroundColor?c.backgroundColor:12303291,me.setClearColor(e,1),me.setSize(Ee.clientWidth,Math.round(Ee.clientWidth*O)),ge=new THREE.Scene,Pe=new THREE.PerspectiveCamera(60,Ee.clientWidth/Ee.clientHeight,.1,1e3),Pe.aspectRatio=O,c.sparePieces===!1&&(Re.multiplyScalar(.9),ze.multiplyScalar(.9)),"white"===c.orientation?Pe.position.set(Re.x,Re.y,Re.z):"black"===c.orientation&&Pe.position.set(ze.x,ze.y,ze.z),Pe.lookAt(new THREE.Vector3(0,-3,0)),ge.add(Pe),me.domElement.addEventListener("mousedown",fe,!0),me.domElement.addEventListener("mousemove",de,!0),me.domElement.addEventListener("mouseup",he,!0),"ontouchstart"in document.documentElement&&(me.domElement.addEventListener("touchstart",function(e){fe(e,!0)},!0),me.domElement.addEventListener("touchmove",function(e){de(e,!0)},!0),me.domElement.addEventListener("touchend",he,!0)),(c.rotateControls||c.zoomControls)&&void 0!==THREE.OrbitControls&&(Se=new THREE.OrbitControls(Pe,me.domElement,me.domElement),Se.enablePan=!1,c.rotateControls?(Se.minPolarAngle=Math.PI/2*.1,Se.maxPolarAngle=Math.PI/2*.8):Se.noRotate=!0,c.zoomControls?(Se.minDistance=12,Se.maxDistance=22,Se.enableZoom=!0):Se.enableZoom=!1,Se.target.y=-3,Se.enabled=!0)}function z(e){Qe=!0;var t=Pe.position,n=t.y,r=e.y,i=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2)),a=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2)),s=Math.acos(t.x/i),p=Math.acos(e.x/a);t.z<0&&(s=-s),e.z<0&&(p=-p),(p-s>=Math.PI||s-p>Math.PI)&&(p>s?p-=2*Math.PI:p+=2*Math.PI);var c=function(){Pe.position.set(e.x,e.y,e.z),Pe.lookAt(new THREE.Vector3(0,-3,0)),Qe=!1,We=!0};o(function(e){var o=s+e*(p-s),t=i+e*(a-i);Pe.position.set(t*Math.cos(o),n+e*(r-n),t*Math.sin(o)),Pe.lookAt(new THREE.Vector3(0,-3,0))},c,1e3)}function M(e,o){var t,n=D(e),r=o.charAt(0),i=o.charAt(1);"w"===r?t=Te.clone():"b"===r&&(t=Ie.clone());var a,s;return a=Ke[i],s=new THREE.Mesh(a,t),s.position.x=n.x,s.position.z=n.z,"w"===r&&(s.rotation.y=Math.PI),s.castShadow=!0,s}function T(){var o=new THREE.FontLoader,t=null;"function"==typeof c.fontData?t=c.fontData():"string"==typeof c.fontData&&(t=c.fontData),null===t&&(c.showNotation=!1,f(2354,e)),o.load(t,function(e){var o={font:e,size:.5,height:0,weight:"normal",style:"normal",curveSegments:12,steps:1,bevelEnabled:!1,material:0,extrudeMaterial:1};be=[];for(var t,n,r="abcdefgh".split(""),i=0;8>i;i++)t=new THREE.TextGeometry(r[i],o),t.computeBoundingBox(),t.computeVertexNormals(),n=new THREE.Mesh(t,De),n.position.x=2*i-7-o.size/2,n.position.y=-.5,n.position.z=-9,be.push(n),ge.add(n),n=new THREE.Mesh(t,_e),n.position.x=2*i-7-o.size/2,n.position.y=-.5,n.position.z=9,be.push(n),ge.add(n);var a="12345678".split("");for(i=0;8>i;i++)t=new THREE.TextGeometry(a[i],o),n=new THREE.Mesh(t,je),n.position.x=-9,n.position.y=-.5,n.position.z=-7-o.size/2+2*(7-i),be.push(n),ge.add(n),n=new THREE.Mesh(t,Le),n.position.x=9,n.position.y=-.5,n.position.z=-7-o.size/2+2*(7-i),be.push(n),ge.add(n)})}function H(){var e;for(e=0;8>e;e++)for(var o=3.5*g-g*e,t=0;8>t;t++){var n=g*t-3.5*g,r="abcdefgh".charAt(t)+(e+1),i=e%2===0^t%2===0?Ue:Ve,a=new THREE.BoxGeometry(2,.5,2),s=new THREE.Mesh(a,i.clone());s.position.set(n,-.25,o),a.computeFaceNormals(),a.computeVertexNormals(),s.receiveShadow=!0,Fe[r]=s.id,s.tag=r,ge.add(s)}c.showNotation&&T();for(var p=0;p<m.length;p++){var l=new THREE.SpotLight(11184810),u=m[p];l.position.set(u[0],u[1],u[2]),l.target=new THREE.Object3D,0===p&&(l.castShadow=!0,l.shadow.bias=1e-4,l.shadow.mapSize.width=2048,l.shadow.mapSize.height=2048),ge.add(l)}var f=new THREE.AmbientLight(5592405);ge.add(f)}function B(){for(var e in Xe)if(Xe.hasOwnProperty(e)&&!p(e))if($e.hasOwnProperty(e)===!1)f(3701,"Square "+e+" in PIECE_MESH_IDS but not in CURRENT_POSITION");else if(!ge.getObjectById(Xe[e])){f(3702,"Mesh not present on square "+e+", adding a replacement.");var o=M(e,$e[e]);ge.add(o),Xe[e]=o.id}for(e in $e)$e.hasOwnProperty(e)&&Xe.hasOwnProperty(e)===!1&&f(3703,"Square "+e+" in CURRENT_POSITION but not in PIECE_MESH_IDS")}function I(e,t,n){var r,i;if(Xe.hasOwnProperty(e)&&(i=ge.getObjectById(Xe[e])),Fe.hasOwnProperty(t)&&(r=ge.getObjectById(Fe[t])),p(e)&&(i=i.clone(),ge.add(i)),r&&i){var a=i.position.x,l=i.position.z,u=r.position.x,f=r.position.z;o(function(e){i.position.x=a+e*(u-a),i.position.z=l+e*(f-l)},function(){Xe[t]=i.id,s(e)&&i.id===Xe[e]&&delete Xe[e],n()},c.moveSpeed)}}function k(e,t){if(Xe.hasOwnProperty(e)&&s(e)&&Xe.hasOwnProperty(e)){var n=ge.getObjectById(Xe[e]);o(function(e){n.opacity=1-e},function(){ge.remove(n),delete Xe[e],t()},c.trashSpeed)}}function q(e,t,n){var r=M(e,t);r.opacity=0,ge.add(r),o(function(e){r.opacity=e},function(){Xe[e]=r.id,n()},c.appearSpeed)}function N(e,o,t){function n(){a--,0===a&&(oe(t),c.hasOwnProperty("moveEnd")&&"function"==typeof c.onMoveEnd&&c.onMoveEnd(r(o,r(t))),We=!0,B(),Qe=!1)}if(0!==e.length){Qe=!0;var i,a=e.length;for(i=0;i<e.length;i++)"clear"===e[i].type&&s(e[i].square)&&Xe.hasOwnProperty(e[i].square)&&k(e[i].square,n);for(i=0;i<e.length;i++)"move"===e[i].type&&I(e[i].source,e[i].destination,n);for(i=0;i<e.length;i++)if("add"===e[i].type)if(c.sparePieces===!0)for(var p in S)S.hasOwnProperty(p)&&S[p]===e[i].piece&&I(p,e[i].square,n);else q(e[i].square,e[i].piece,n)}}function D(e){var o,t;if(p(e)){var n=e.charCodeAt(2)-"1".charCodeAt(0);o=g*(4*n-10)/3,"w"==e.charAt(1)?t=5*g:"b"==e.charAt(1)&&(t=-5*g)}else s(e)&&(o=g*(e.charCodeAt(0)-"a".charCodeAt(0))-3.5*g,t=3.5*g-g*(e.charCodeAt(1)-"1".charCodeAt(0)));return{x:o,z:t}}function _(e){var o;return p(e)?o=S:s(e)&&(o=$e),o?o[e]:void 0}function j(e,o){e=e.split("");var t=E.indexOf(e[0])+1,n=parseInt(e[1],10);o=o.split("");var r=E.indexOf(o[0])+1,i=parseInt(o[1],10),a=Math.abs(t-r),s=Math.abs(n-i);return a>=s?a:s}function L(e){var o,t,n=[];for(o=0;8>o;o++)for(t=0;8>t;t++){var r=E[o]+(t+1);e!==r&&n.push({square:r,distance:j(e,r)})}n.sort(function(e,o){return e.distance-o.distance});var i=[];for(o=0;o<n.length;o++)i.push(n[o].square);return i}function A(e,o,t){for(var n=L(t),r=0;r<n.length;r++){var i=n[r];if(e.hasOwnProperty(i)===!0&&e[i]===o)return i}return!1}function V(e,o){var t,n=r(e),i=r(o),a=[];for(t in i)i.hasOwnProperty(t)===!0&&n.hasOwnProperty(t)===!0&&n[t]===i[t]&&(delete n[t],delete i[t]);for(t in i)if(i.hasOwnProperty(t)===!0){var s=A(n,i[t],t);s!==!1&&(a.push({type:"move",source:s,destination:t,piece:i[t]}),delete n[s],delete i[t])}for(t in i)i.hasOwnProperty(t)===!0&&(a.push({type:"add",square:t,piece:i[t]}),delete i[t]);for(t in n)n.hasOwnProperty(t)===!0&&(a.push({type:"clear",square:t,piece:n[t]}),delete n[t]);return a}function G(e,o){var t=new THREE.Vector3(e/me.domElement.width*2-1,1-o/me.domElement.height*2,-.5);return t.unproject(Pe),new THREE.Raycaster(Pe.position,t.sub(Pe.position).normalize())}function U(e,o,t){var n=new THREE.Plane(new THREE.Vector3(0,1,0),-t),r=G(e,o),i=r.ray.intersectPlane(n);return i?new THREE.Vector3(i.x,t,i.z):null}function K(e,o){for(var t in Fe)if(Fe.hasOwnProperty(t)){var n=ge.getObjectById(Fe[t]);if(e>=n.position.x-g/2&&e<n.position.x+g/2&&o>=n.position.z-g/2&&o<n.position.z+g/2)return t}if(c.sparePieces){var r;if(o>=4*g&&6*g>=o)r="w";else{if(!(-4*g>=o&&o>=-6*g))return"offboard";r="b"}var i=Math.round(1+(10-3*e/g)/4);if(i>=1&&6>=i)return t="s"+r+i}return"offboard"}function Q(e,o){var t,n,r,i,a=G(e,o),s={},p=[],c=0;for(n in Xe)if(Xe.hasOwnProperty(n)){var l=ge.getObjectById(Xe[n]);r=_(n);var u=Ke[r.charAt(1)].boundingBox.clone();u.min.x+=l.position.x,u.max.x+=l.position.x,u.min.z+=l.position.z,u.max.z+=l.position.z,t=a.ray.intersectBox(u),t&&(s[n]=t,p.push(l),c++)}if(p.length>0){if(1===p.length)return n=Object.keys(s)[0],t=s[n],i=p[0],{source:n,location:n,piece:_(n),mesh:i,intersection_point:t,off_center_x:t.x-i.position.x,off_center_z:t.z-i.position.z};var f=a.intersectObjects(p);if(f.length>0)for(n in s)if(s.hasOwnProperty(n)&&(i=ge.getObjectById(Xe[n]),i===f[0].object))return t=f[0].point,{source:n,location:n,piece:_(n),mesh:i,intersection_point:t,off_center_x:t.x-i.position.x,off_center_z:t.z-i.position.z}}var d=U(e,o,0);return d?(n=K(d.x,d.z),r=_(n),i=ge.getObjectById(Xe[n]),{source:n,location:n,piece:r,mesh:i,intersection_point:new THREE.Vector3(d.x,0,d.z),off_center_x:i?d.x-i.position.x:void 0,off_center_z:i?d.z-i.position.z:void 0}):{source:"offboard",location:"offboard"}}function W(e,o,t){var n=U(o,t,e.intersection_point.y);n&&(n.x-=e.off_center_x,n.z-=e.off_center_z,e.location=K(n.x,n.z),e.mesh.position.x===n.x&&e.mesh.position.z===n.z||(e.mesh.position.x=n.x,e.mesh.position.z=n.z))}function J(){for(var e in S)if(S.hasOwnProperty(e)){var o=S[e],t=M(e,o);t.position.y=-.5,Xe[e]=t.id,ge.add(t)}}function $(){if(ie(),p(Ye.source))ge.remove(Ye.mesh),Ye=null;else{var e=Ye.mesh.position.x,t=Ye.mesh.position.z,n=ge.getObjectById(Fe[Ye.source]),i=n.position.x,a=n.position.z,s=function(){Ye.mesh.position.x=i,Ye.mesh.position.z=a;var e=Ye.piece,o=Ye.source;Ye=null,c.hasOwnProperty("onSnapbackEnd")&&"function"==typeof c.onSnapbackEnd&&c.onSnapbackEnd(e,o,r($e),Je),Qe=!1,We=!0};o(function(o){Ye.mesh.position.x=e+o*(i-e),Ye.mesh.position.z=t+o*(a-t)},s,100)}}function F(){if(ie(),ge.remove(Ye.mesh),s(Ye.source)){var e=r($e);delete e[Ye.source],oe(e),delete Xe[Ye.source]}Ye=null}function X(){ie();var e=r($e),o=ge.getObjectById(Fe[Ye.location]);Ye.mesh.position.x=o.position.x,Ye.mesh.position.z=o.position.z,s(Ye.source)&&(delete e[Ye.source],delete Xe[Ye.source]),e[Ye.location]&&ge.remove(ge.getObjectById(Xe[Ye.location])),e[Ye.location]=Ye.piece,Xe[Ye.location]=Ye.mesh.id;var t=Ye.source,n=Ye.location,i=Ye.piece;Ye=null,oe(e),c.hasOwnProperty("onSnapEnd")&&"function"==typeof c.onSnapEnd&&c.onSnapEnd(t,n,i)}function Y(){for(var e in Xe)Xe.hasOwnProperty(e)===!0&&(p(e)||(ge.remove(ge.getObjectById(Xe[e])),delete Xe[e]));for(var o in $e)if($e.hasOwnProperty(o)===!0){var t=M(o,$e[o]);Xe[o]=t.id,ge.add(t)}}function Z(){c.sparePieces&&J(),Y()}function ee(e,o){e=r(e);for(var t in o)if(o.hasOwnProperty(t)===!0&&e.hasOwnProperty(t)===!0){var n=e[t];delete e[t],e[o[t]]=n}return e}function oe(e){var o=r($e),t=r(e),n=w(o),i=w(t);n!==i&&(c.hasOwnProperty("onChange")&&"function"==typeof c.onChange&&c.onChange(o,t),$e=e)}function te(e,o){o||(o=16776960);var t=ge.getObjectById(Fe[e]),n=null;if(t){var r=new THREE.TorusGeometry(1.2*g/2,.1,4,4);n=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:new THREE.Color(o)})),n.position.x=t.position.x,n.position.y=0,n.position.z=t.position.z,n.rotation.z=Math.PI/4,n.rotation.x=Math.PI/2,ge.add(n)}return n}function ne(){Ze&&(ge.remove(Ze),Ze=null)}function re(){eo&&(ge.remove(eo),eo=null)}function ie(){ne(),re(),Ce.removeGreySquares()}function ae(e){ne(),Ze=te(e)}function se(e){re(),eo=te(e)}function pe(){return Se&&(Se.enabled=!1),c.hasOwnProperty("onDragStart")&&"function"==typeof c.onDragStart&&c.onDragStart(Ye.source,Ye.piece,r($e),Je)===!1?void(Ye=null):void(p(Ye.source)?(Ye.mesh=Ye.mesh.clone(),Ye.mesh.position.y=0,ge.add(Ye.mesh),We=!0):s(Ye.source)&&ae(Ye.source))}function ce(e,o){var t=Ye.location;W(Ye,e,o),t!==Ye.location&&(re(),s(Ye.location)&&Ye.location!==Ye.source&&se(Ye.location)),c.hasOwnProperty("onDragMove")&&"function"==typeof c.onDragMove&&c.onDragMove(Ye.location,t,Ye.source,Ye.piece,r($e),Je)}function le(){var e="drop";if(("offboard"===Ye.location||p(Ye.location))&&("snapback"===c.dropOffBoard&&(e="snapback"),"trash"===c.dropOffBoard&&(e="trash")),c.hasOwnProperty("onDrop")&&"function"==typeof c.onDrop){var o=r($e);p(Ye.source)&&s(Ye.location)&&(o[Ye.location]=Ye.piece),s(Ye.source)&&!s(Ye.location)&&delete o[Ye.source],s(Ye.source)&&s(Ye.location)&&(delete o[Ye.source],o[Ye.location]=Ye.piece);var t=r($e),n=c.onDrop(Ye.source,Ye.location,Ye.piece,o,t,Je);"snapback"!==n&&"trash"!==n||(e=n)}"snapback"===e?$():"trash"===e?F():"drop"===e&&X(),Se&&(Se.enabled=!0),We=!0,ie()}function ue(e,o){var t,n,r=e.target||e.srcElement,i=r.getBoundingClientRect();return o&&e.touches.length>0?(t=e.touches[0].clientX-i.left,n=e.touches[0].clientY-i.top):(t=e.clientX-i.left,n=e.clientY-i.top),{x:t,y:n}}function fe(e,o){if(e.preventDefault(),!Ye&&c.draggable){var t=ue(e,o),n=Q(t.x,t.y);n&&void 0!==n.piece?(Ye=n,to="offboard",pe()):Se&&(Se.enabled=!0)}}function de(e,o){e.preventDefault();var t=ue(e,o);if(Ye)ce(t.x,t.y);else{var n,i;if(c.hasOwnProperty("onMouseoutSquare")&&"function"==typeof c.onMouseoutSquare&&(n=c.onMouseoutSquare),c.hasOwnProperty("onMouseoverSquare")&&"function"==typeof c.onMouseoverSquare&&(i=c.onMouseoverSquare),n||i){var a=Q(t.x,t.y).source,p=r($e);if(a!==to){var l;n&&s(to)&&(l=!1,p.hasOwnProperty(to)&&(l=p[to]),n(to,l,p,Je)),i&&s(a)&&(l=!1,p.hasOwnProperty(a)&&(l=p[a]),i(a,l,p,Je)),to=a}}}}function he(e){e.preventDefault(),Ye&&le()}function we(e){var o;if("function"==typeof c.pieceSet)o=c.pieceSet(e);else if("string"==typeof c.pieceSet){var t=c.pieceSet;o=t.replace("{piece}",e)}var n=new THREE.JSONLoader;c.hasOwnProperty("localStorage")&&c.localStorage===!1&&window.localStorage.removeItem(o);var r=window.localStorage.getItem(o);if(r){var i=JSON.parse(r),a=n.parse(i.data);Ke[e]=a.geometry,Ke[e].computeBoundingBox()}else n.load(o,function(t){Ke[e]=t,t.computeBoundingBox(),c.hasOwnProperty("localStorage")!==!1&&c.localStorage===!1||window.localStorage.setItem(o,JSON.stringify(t.toJSON()))})}function ve(){return void 0!==Ke.P&&void 0!==Ke.N&&void 0!==Ke.B&&void 0!==Ke.R&&void 0!==Ke.Q&&void 0!==Ke.K}function ye(){function e(){ve()?(Z(),o()):setTimeout(e,20)}function o(){requestAnimationFrame(o),t();var e=Pe.position.clone();Se&&Se.enabled&&Se.update();var n=Pe.position.x!==e.x||Pe.position.y!==e.y||Pe.position.z!==e.z;if(We||n){var i=Pe.position.x,a=Pe.position.y,s=Pe.position.z;for(var p in be)be.hasOwnProperty(p)&&be[p].lookAt(new THREE.Vector3(100*i,100*a,100*s));-8>=i?(je.opacity=1,Le.opacity=0):i>=8?(je.opacity=0,Le.opacity=1):je.opacity=Le.opacity=1,-8>=s?(De.opacity=1,_e.opacity=0):s>=8?(De.opacity=0,_e.opacity=1):De.opacity=_e.opacity=1}if(We||null!==Ye||Qe||n){var l=!0;if(c.hasOwnProperty("onRender")&&"function"==typeof c.onRender&&c.onRender(ge,r(Fe),r(Xe),r($e))===!1&&(l=!1),l){if(!xe){for(;Ee.firstChild;)Ee.removeChild(Ee.firstChild);Ee.appendChild(me.domElement),xe=!0}me.render(ge,Pe),We=!1}else We=!0}}d()===!0&&C()===!0&&(Ce.resize(),R(),H(),we("K"),we("Q"),we("R"),we("B"),we("N"),we("P"),e())}c=c||{};var Ee,me,ge,be,Pe,Se,Oe=h(y),xe=!1,Ce={},Re=new THREE.Vector3(0,P*Math.cos(b),P*Math.sin(b)),ze=new THREE.Vector3(0,P*Math.cos(b),-P*Math.sin(b)),Me=11184810;c.hasOwnProperty("whitePieceColor")&&"number"==typeof c.whitePieceColor&&(Me=c.whitePieceColor);var Te=new THREE.MeshPhongMaterial({color:new THREE.Color(Me)}),He=13434879;c.hasOwnProperty("whitePieceSpecular")&&"number"==typeof c.whitePieceSpecular&&(He=c.whitePieceSpecular),Te.specular=new THREE.Color(He),Te.transparent=!0;var Be=3355443;c.hasOwnProperty("blackPieceColor")&&"number"==typeof c.blackPieceColor&&(Be=c.blackPieceColor);var Ie=new THREE.MeshPhongMaterial({color:new THREE.Color(Be)}),ke=5583667;c.hasOwnProperty("blackPieceSpecular")&&"number"==typeof c.blackPieceSpecular&&(ke=c.blackPieceSpecular),Ie.specular=new THREE.Color(ke),Ie.transparent=!0;var qe=0;c.hasOwnProperty("notationColor")&&"number"==typeof c.notationColor&&(qe=c.notationColor);var Ne=new THREE.MeshBasicMaterial({color:new THREE.Color(qe)});Ne.transparent=!0;var De=Ne.clone(),_e=Ne.clone(),je=Ne.clone(),Le=Ne.clone(),Ae=11962467;c.hasOwnProperty("darkSquareColor")&&"number"==typeof c.darkSquareColor&&(Ae=c.darkSquareColor);var Ve=new THREE.MeshPhongMaterial({color:new THREE.Color(Ae)}),Ge=15784373;c.hasOwnProperty("lightSquareColor")&&"number"==typeof c.lightSquareColor&&(Ge=c.lightSquareColor);var Ue=new THREE.MeshPhongMaterial({color:new THREE.Color(Ge)}),Ke={K:void 0,Q:void 0,R:void 0,B:void 0,N:void 0,P:void 0},Qe=!1,We=!0,Je="white",$e={},Fe={},Xe={},Ye=null,Ze=null,eo=null,oo=[],to="offboard";return Ce.clear=function(e){Ce.position({},e)},Ce.destroy=function(){me.domElement.removeEventListener("mousedown",fe),me.domElement.removeEventListener("mousemove",de),me.domElement.removeEventListener("mouseup",he),Ee.removeChild(me.domElement)},Ce.fen=function(){return Ce.position("fen")},Ce.flip=function(){return Ce.orientation("flip")},Ce.greySquare=function(e){oo.push(te(e,4210752)),We=!0},Ce.removeGreySquares=function(){for(;oo.length>0;)ge.remove(oo.pop());oo=[],We=!0},Ce.move=function(){if(0!==arguments.length){for(var e=!0,o={},t=0;t<arguments.length;t++)if(arguments[t]!==!1)if(i(arguments[t])===!0){var n=arguments[t].split("-");o[n[0]]=n[1]}else f(2826,"Invalid move passed to the move method.",arguments[t]);else e=!1;var r=ee($e,o);return Ce.position(r,e),r}},Ce.orientation=function(e){return 0===arguments.length?Je:"white"===e||"black"===e?(Je=e,z("white"===e?Re:ze),Je):"flip"===e?(Je="white"===Je?"black":"white",z("white"===Je?Re:ze),Je):void f(5482,"Invalid value passed to the orientation method.",e)},Ce.flip=function(){Ce.orientation("flip")},Ce.position=function(e,o){if(0===arguments.length)return r($e);if("string"==typeof e&&"fen"===e.toLowerCase())return w($e);if(o!==!1&&(o=!0),"string"==typeof e&&"start"===e.toLowerCase()&&(e=r(Oe)),l(e)===!0&&(e=h(e)),u(e)!==!0)return void f(6482,"Invalid value passed to the position method.",e);var t=function(){if(o){var t=V($e,e);N(t,$e,e)}else oe(e),Y(),We=!0};if(ve()&&Qe===!1)t();else{var n=function(){ve()===!1||Qe?setTimeout(n,100):t()};n()}},Ce.resize=function(){var e=Ee.clientWidth;Pe&&Pe.updateProjectionMatrix(),me&&me.setSize(e,e*O),We=!0},Ce.rerender=function(){We=!0},Ce.start=function(e){Ce.position("start",e)},ye(),Ce},window.ChessBoard3.webGLEnabled=n,window.ChessBoard3.fenToObj=h,window.ChessBoard3.objToFen=w}();